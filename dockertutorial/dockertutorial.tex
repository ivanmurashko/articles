%% -*- coding:utf-8 -*- 
\documentclass[14pt,a4paper]{article} 

\usepackage[utf8]{inputenc}
\usepackage{minted}
\usepackage{longtable}
\usepackage{hyperref}
\hypersetup{
  pdftex,
  allcolors=blue,
  bookmarksnumbered=true,     
  bookmarksopen=true,         
  bookmarksopenlevel=1,       
  colorlinks=true,            
  pdfstartview=Fit,           
  pdfpagemode=UseOutlines,  
  pdfpagelayout=TwoPageRight,
  pdftitle={Docker tutorial},
  pdfsubject={Docker},
  pdfauthor={Ivan Murashk–æ},
  pdfkeywords={Docker, tutorial}
}

\title{Docker tutorial}
\author{Ivan Murashko}
\date{}
\begin{document}

\maketitle
\tableofcontents

\section*{Introduction}
There are several examples of docker usage. They are collected in one
place mainly for future references.

The source code for examples can be found in the article git
repository \cite{github:articles_ivanmurashko} in the folder 
\textbf{dockertutorial/src}.

\section{Base commands}

\subsection{Simple program run}
You can run a command (\textbf{uname -a}) with 
\begin{minted}{shell}
$ docker run ubuntu uname -a
\end{minted}
The container \textbf{ubuntu:latest} will be used in the case. 

The command execution status can be viewed with
\begin{verbatim}
$ docker ps -a 
CONTAINER ID   IMAGE   COMMAND     CREATED         ...
b5e8d82cce29   ubuntu  "uname -a"  5 seconds ago  ...
\end{verbatim}
If you run the docker with \textbf{--rm} flag then the status info
will not be stored.


\subsection{Interactive session}
You can run an interactive shell with
\begin{minted}{shell}
$ docker run -it ubuntu /bin/bash
\end{minted}
where \textbf{-it} means \textbf{--interactive --tty}, 
\textbf{ubuntu} the latest ubuntu image and \textbf{/bin/bash} - the
command to be start 

\subsection{Docker as a daemon}
First of all run the docker in interactive mode and as daemon
\begin{minted}{shell}
$ docker run -itd ubuntu
\end{minted}
possible output
\begin{verbatim}
649dae02de59ea3eb065a40b1248b2d322986e563ab12af3126fa4bb4710008a
\end{verbatim}
Check the docker run in daemon mode with
\begin{minted}{shell}
$ docker ps
\end{minted}
output:
\begin{verbatim}
$ docker ps 
CONTAINER ID        IMAGE               COMMAND     ...
649dae02de59        ubuntu              "/bin/bash" ...
\end{verbatim}
Execute \textbf{ls /var} command in the run docker
\begin{verbatim}
$ docker exec -it 649dae02de59 ls /var
backups  cache  lib  local  lock  log  mail  opt  run  spool  tmp
\end{verbatim}
Stop it with
\begin{verbatim}
$ docker stop 649dae02de59
649dae02de59
\end{verbatim}
Check the result
\begin{verbatim}
$ docker ps
CONTAINER ID        IMAGE               COMMAND   ...
\end{verbatim}

\subsection{Network daemon}
You can run a nginx web server with the following command
\begin{verbatim}
$ docker run -p 8080:80 -d nginx
\end{verbatim}
This will map docker container port 80 to the host port 8080 or in
other words make the nginx server available on the host machine via port
8080:
\begin{verbatim}
$ telnet localhost 8080
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
HEAD / HTTP/1.0

HTTP/1.1 200 OK
Server: nginx/1.17.4
Date: Sat, 28 Sep 2019 18:44:45 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Tue, 24 Sep 2019 14:49:10 GMT
Connection: close
ETag: "5d8a2ce6-264"
Accept-Ranges: bytes

Connection closed by foreign host.
\end{verbatim}

\subsection{Stop all}
You can stop all containers with
\begin{verbatim}
$ docker container stop $(docker container ls -aq)
\end{verbatim}

\subsection{Cleanup}
The following command will remove everything
\begin{verbatim}
$ docker system prune -a
WARNING! This will remove:
        - all stopped containers
        - all networks not used by at least one container
        - all images without at least one container associated to them
        - all build cache
Are you sure you want to continue? [y/N] y
Deleted Containers:
b5e8d82cce2942a24c709b630ff4e0dd705b89d78f2777065446ce97cf152cab
...
Total reclaimed space: 6.113GB
\end{verbatim}

\section{Creating docker images}
In the example we will create a docker image that will help us to
compile and run code that uses thrift protocol \cite{apache:thrift}.
The necessary libs for us are C++ and PHP. 

The Dockerfile can be found in the article git
repository \cite{github:articles_ivanmurashko} in the folder 
\textbf{dockertutorial/src/thrift}.
\inputminted{shell}{./src/thrift/Dockerfile}

TBD

\section{Apps in docker}
I am going to create a small application that consists of 2 parts. The
first one is front-end written in php that communicates with a back-end server
written in C++. The communication is done via thrift protocol
\cite{apache:thrift}. The front-end server as well as back-end server
are run in different container and all communication is done via the
network. 

TBD

\bibliographystyle{gost780s}  
\bibliography{dockertutorial}     


\end{document}
