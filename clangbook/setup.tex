%% -*- coding:utf-8 -*-
\chapter{Environment setup}

The chapter describes basic steps to be done to setup the environment
be used for future experiments with clang.

\section{Source code compilation}

we are going to compile our source code in debug mode to be suitable
for future investigations with debugger.

\subsection{Getting the source code}

The clang source is a part of LLVM. You can get it with the following
command
\begin{minted}{text}
  git clone https://github.com/llvm/llvm-project.git
  cd llvm-project
\end{minted}

\subsection{Configuration with cmake}
Create a build folder where the compiler and related tools will be
built
\begin{minted}{text}
mkdir build
cd build
\end{minted}
Run configure script
\begin{minted}[breaklines]{text}
cmake -G Ninja -DCMAKE_BUILD_TYPE=RelWithDebInfo -DLLVM_TARGETS_TO_BUILD="X86" -DLLVM_ENABLE_PROJECTS="clang;clang-tools-extra" -DLLVM_USE_LINKER=gold -DLLVM_USE_SPLIT_DWARF=ON ../llvm
\end{minted}
The are several options specified:
\begin{itemize}
  \item \mintinline{text}{-DLLVM_TARGETS_TO_BUILD="X86"} specifies exact
    targets to be build. It will avoid build unnecessary targets
  \item \mintinline{text}{LLVM_ENABLE_PROJECTS="clang;clang-tools-extra"}
    specifies LLVM projects that we care about
\item \mintinline{text}{LLVM_USE_LINKER=gold} - uses gold linker
\item \mintinline{text}{LLVM_USE_SPLIT_DWARF=ON} - spits debug information into
  separate files. This option saves disk space as well as memory
  consumption during the LLVM build. The option require compiler used
  for clang build to support it
\end{itemize}


\subsection{Build}
The build is trivial
\begin{minted}{text}
ninja clang
\end{minted}
You can also run unit and end-to-end tests for the compiler with
\begin{minted}{text}
ninja check-clang
\end{minted}
The compiler binary can be found as \mintinline{text}{bin/clang} at the build folder. 
